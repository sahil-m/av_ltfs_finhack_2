---
title: "R Notebook"
output: html_notebook
---

```{r}
otrain <- read_csv('data/train.csv')
otest <- read_csv('data/test.csv')
glimpse(otrain)
```

```{r}
summary(otrain$application_date)
```


```{r}
table(otrain$segment, useNA = "ifany")
```

```{r}
sort(table(otrain$branch_id, useNA = 'ifany'))
n_distinct(otrain$branch_id)
```

```{r}
sort(round(prop.table(table(otrain$state, useNA = 'ifany'))*100, 2))
n_distinct(otrain$state)
```

```{r}
sort(round(prop.table(table(otrain$zone, useNA = 'ifany'))*100, 2))
```

```{r}
summary(otrain$case_count)
```

```{r}
state_zone_table <- addmargins(round(prop.table(table(otrain$state, otrain$zone))*100, 2))
state_zone_table[order(state_zone_table[,"Sum"], decreasing = TRUE),]

# addmargins(round(prop.table(table(otrain$state, otrain$zone))*100, 2)) %>% 
#   as.data.frame.matrix() %>% 
#   mutate(state = row.names(.)) %>%
#   dplyr::arrange(desc(Sum)) %>% 
#   kable()
```

```{r}
train_wide <- otrain %>% 
  pivot_wider(id_cols = application_date, names_from = c(zone, segment), values_from = case_count, values_fn = list(case_count = sum))

train_wide_xts <- xts(dplyr::select(train_wide, -application_date), order.by = train_wide$application_date)
```

```{r, fig.width=10, fig.height=4}
dygraph(train_wide_xts) %>% 
  dyOptions(drawPoints = TRUE, pointSize = 2) %>% 
  dySeries("NA_2", axis = 'y2') %>% 
  dyRangeSelector()
```

